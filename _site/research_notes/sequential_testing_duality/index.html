<!DOCTYPE html>
<html lang="en-us">

  <head prefix="og: http://ogp.me/ns#; dc: http://purl.org/dc/terms/#">
  
  
  <!-- Canonical link to help search engines -->
  <link rel="canonical" href="http://localhost:4000/research_notes/sequential_testing_duality/" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PN2H9928PZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PN2H9928PZ');
  </script>

  <!-- Basic meta elements -->
  <meta charset="utf-8" />

  <!-- Enable responsiveness on mobile devices -->
  <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no" />

  <!-- Mathjax Support -->
  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <title>
    
     Inverting Sequential Tests
    
  </title>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Inverting Sequential Tests" />
<meta name="author" content="Ben Chugg" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A short note on the duality of sequential hypothesis testing and confidence sequences" />
<meta property="og:description" content="A short note on the duality of sequential hypothesis testing and confidence sequences" />
<link rel="canonical" href="http://localhost:4000/research_notes/sequential_testing_duality/" />
<meta property="og:url" content="http://localhost:4000/research_notes/sequential_testing_duality/" />
<meta property="og:site_name" content="benny" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-29T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Inverting Sequential Tests" />
<meta name="twitter:site" content="@bennychugg" />
<meta name="twitter:creator" content="@Ben Chugg" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ben Chugg","url":"https://benchugg.com"},"dateModified":"2023-03-29T00:00:00-07:00","datePublished":"2023-03-29T00:00:00-07:00","description":"A short note on the duality of sequential hypothesis testing and confidence sequences","headline":"Inverting Sequential Tests","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/research_notes/sequential_testing_duality/"},"url":"http://localhost:4000/research_notes/sequential_testing_duality/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Dublin Core metadata for Zotero -->
  <meta property="dc:title" content="Inverting Sequential Tests" />
  <meta property="dc:creator" content="Ben Chugg" />
  <meta property="dc:identifier" content="http://localhost:4000/research_notes/sequential_testing_duality/" />
  
  <meta property="dc:date" content="2023-03-29 00:00:00 -0700" />
  
  <meta property="dc:source" content="benny" />

  <!-- Open Graph and Twitter metadata -->
  <meta property="og:title" content="Inverting Sequential Tests" />
  <meta property="og:url" content="http://localhost:4000/research_notes/sequential_testing_duality/" />
  
    <meta property="og:image" content="http://localhost:4000/assets/images/heads.jpeg"/>
    <meta name="twitter:image" content="http://localhost:4000/assets/images/heads.jpeg" />
  
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary">
  <meta name="twitter:domain" value="benchugg.com" />
  <meta name="twitter:title" value="Inverting Sequential Tests" />
  <meta name="twitter:url" value="http://localhost:4000" />
  
  <!-- Description is dependent on page type  -->
  
    <meta property="og:description" content="A short note on the duality of sequential hypothesis testing and confidence sequences">
    <meta name="twitter:description" value="A short note on the duality of sequential hypothesis testing and confidence sequences" />
    <meta property="og:type" content="article" />
  
  

  <!-- CSS link -->
  <link rel="stylesheet" href="/assets/css/style.css" />

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="167x167" href="/assets/favicon.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/assets/favicon.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" href="/assets/favicon.ico">
  <link rel="shortcut icon" href="/assets/favicon.ico" />
  <link rel=”apple-touch-icon” sizes="114×114" href="/assets/favicon.ico" />
  <link rel=”apple-touch-icon” sizes="72×72" href="/assets/favicon.ico" />
  <link rel=”apple-touch-icon” href="/assets/favicon.ico" />
  <link rel=”icon” href="/assets/favicon.ico", sizes="32x32"/>

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml" />

  
</head>


  <body class="theme-base-">


    <!--
      Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS
      collisions with our real content.
    -->
    <div class="wrap">
      <header class="masthead">
        <div class="container">
          <a id='name' href="/">Ben Chugg</a>
          <div class="span">
            <a href="/papers/">Papers</a> 
            <a href="/writing/">Writing</a>
            <a href="/research_notes/">Notes</a>
            <a href="http://incrementspodcast.com">Podcast</a>
          </div>
        </div>
      </header>

      <main class="container content" id="main">
        <article class="note">
  <small>
    <a id="back", href="/research_notes/">Back to all notes</a>
  </small>
  <hr>
  
  <p class='title'>Inverting Sequential Tests</p> 
  <p id="date">March 29, 2023</p>
  \[\newcommand{\cX}{\mathcal{X}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\ind}{\mathbf{1}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\cK}{\mathcal{K}}\]

<h1 id="1-fixed-time-duality">1. Fixed-time duality</h1>

<p>There is a well known duality between fixed-time hypothesis testing and confidence intervals. Suppose we are testing the hypotheses</p>

\[H_0: \theta = \theta^*, \quad H_1: \theta\neq \theta^*,\]

<p>for some fixed and known \(\theta^*\). We receive samples \(X^n \equiv  X_1,\dots,X_n\), \(X_i\in \cX\) drawn from some distribution \(P\). A hypothesis test based on \(n\) samples is a function \(\phi: \cX^n \to \{0,1\},\) where we interpret \(\phi(X^n) = 1\) to mean “reject the null”, and \(\phi(X^n) = 0\) to mean “don’t reject the null” (or “maintain the null”, or “fail to reject the null”, etc. All are equivalent — no wonder Wittgenstein thought everything boiled down to language games).  We say the test is <em>level</em>-\(\alpha\) if</p>

\[\sup_{P\in H_0} P(\phi(X^n) = 1) \leq \alpha.\]

<p>That is, if the null is true, then \(\phi\) rejects it with probability at most \(\alpha\) . (In other words, the false positive rate is at most \(\alpha\).)</p>

<p>Meanwhile, a \((1-\alpha)\) confidence interval for \(\theta\) (or, more accurately, region) is a random set \(C = C(X^n)\) such that</p>

\[\sup_{P\in\mathcal{P}(\theta)}P(\theta\in C(X^n)) \geq 1-\alpha,\]

<p>where \(\mathcal{P}(\theta)\) are all the distributions which have \(\theta\) as the parameter of interest. (E.g., if we are testing means, then it would be the set of all distributions with mean \(\theta\)).</p>

<p>Suppose we have a level-\(\alpha\) test \(\phi^{\theta^*}\) which tests the null \(H_0: \theta = \theta^*\) against the alternative \(H_1: \theta\neq \theta^*\). 
Construct the following confidence region:</p>

\[C(X^n) = \{\theta: \phi^{\theta}(X^n) = 0\}.\]

<p>Then,</p>

\[\sup_{P\in \mathcal{P}(\theta^*)}P(\theta^* \notin C(X^n)) = \sup_{P\in\cP(\theta^*)}P(\phi^{\theta^*}=1) =\sup_{P\in H_0}P(\phi^{\theta^*}=1) \leq \alpha,\]

<p>since the set of distributions in \(\cP(\theta^*)\) is the set for which the null \(H_0 : \theta =\theta^*\) is true. On the other hand, suppose you have a \((1-\alpha)\) confidence interval for some \(\theta^*\). Then construct a hypothesis test \(\phi\) which simply rejects if \(\theta^*\notin C(X_1,\dots,X_n)\). It’s easy to see that \(\phi\) is level-\(\alpha\). Therefore, confidence intervals are, in some sense, equivalent to confidence intervals. We’ll see that this equivalence extends to the sequential setting as well.</p>

<h1 id="2-sequential-tests">2. Sequential tests</h1>

<p>A sequential test is a sequence of functions \(\phi = (\phi_t)_{t\geq 1}\) where \(\phi_t\) maps \(t\) observations \(Z_1,\dots,Z_t\) to \(\{0,1\}\). Similarly to fixed-time testing \(\phi_t = \phi_t(Z_1,\dots,Z_t)=1\) is interpreted as “reject the null” at which point, in the sequential setting, we stop testing. Thus, a sequential test can equivalently be identified by the stopping time \(\tau = \inf_t \{\phi_t = 1\}\). A sequential test is level-\(\alpha\) if</p>

\[\sup_{P\in H_0} P(\exists t\geq 1: \phi_t=1) = \sup_{P\in H_0} P(\tau &lt; \infty) \leq \alpha,\]

<p>meaning \(\phi\) controls the type I error simultaneously over all time steps.</p>

<p>As one would expect, the duality for sequential testing is based off of confidence sequences, which are confidence intervals that hold uniformly over time. More precisely, a confidence sequence for a parameter \(\theta\) is a random sequence of sets \(C = (C_t)_{t\geq 1}\) such that</p>

\[\sup_{P\in \cP(\theta)} P(\forall t\geq 1: \theta \in C_t)\geq 1-\alpha.\]

<p>The duality between sequential tests and confidence sequences is nearly identical to the fixed-time setting. Given a \((1-\alpha)\)-confidence sequence \((C_t)\), defining \(\phi_t = \ind(\theta^* \notin C_t)\) gives a level-\(\alpha\) test. Likewise, if \(\phi = (\phi_t)\) is a level-\(\alpha\) sequential test then taking \(C_t = \{\theta: \phi_t^\theta = 0\}\) results in a \((1-\alpha)\) confidence sequence.</p>

<h1 id="3-constructing-sequential-tests">3. Constructing sequential tests</h1>

<p>Noticing the duality between sequential tests and confidence sequences is all well and good – but does it help us when actually constructing sequential tests?</p>

<p>We’ve seen before how to construct confidence sequences using (super)martingales. We do this by employing Ville’s inequality. This relationship is a large part of the recent surge of interest in anytime-valid inference and game-theoretic probability. Indeed, the wealth process from the latter, which <a href="/research_notes/intro_game_theory_prob/">we recall</a> is</p>

\[\cK_t(\mu) = \prod_{i=1}^t (1 + \lambda_i (X_i - \mu)),\]

<p>is a \(P\)-martingale for any distribution \(P\) on \([0,1]^\infty\) with mean \(\mu\).</p>

<p>But notice we can generalize this further. Indeed, suppose \(E=(E_t)_{t\geq 1}\) is a sequence such that, for all \(P\in \cP\) there exists some (super)martingale \(M_t^P\) such that</p>

\[E_t \leq M_t^P\quad P\text{-almost surely}.\]

<p>Then, the probability that \(E_t\) ever exceeds \(1/\alpha\) under any \(P\in \cP\) is also bounded by \(\alpha\). This immediately yields a sequential test for the null \(H_0: P \in \cP\) versus \(H_1: P\notin \cP\): set \(\tau = \inf_t \{ E_t &gt; 1/\alpha\}\).</p>

<p>The construction is general enough that such processes have been given a name: <em>e-processes</em>. At any time \(t\) the value \(E_t\) of an e-process is an <em>e-value</em> for \(\cP\), which simply a random variable with expected value at most 1 under any \(P\in\cP\).  This is because \(\E_P[E_t ]\leq \E_P[M_t^P]\leq 1\).</p>

<p>In fact, it has been <a rel="nofollow noopener noreferrer" href="https://arxiv.org/pdf/2009.03167.pdf">shown</a> that “well-behaved” e-processes must obey \(E_t = \inf_P M_t^P\). Therefore, if \(\cP = \{P\}\) is a singleton and \(M_t^P\) is a martingale (as opposed to a supermartingale), then</p>

\[1 = \E_P [M_t^P] = \E_P [E_t] = \int E_t dP,\]

<p>which implies that \(E_t dP\) is the density of some distribution \(Q\). That is, \(dQ = E_t dP\), so \(E_t\) is the Radon-Nikodym derivative \(dQ / dP\). Thus, in this case, we have simply recovered the likelihood ratio-test (based on the samples \(X_1,\dots,X_t\))! In fact, this shows that the likelihood-ratio test is anytime-valid. But the theory of e-processes is more general than this, since we may consider composite distributions \(\cP\) (such as, e.g., the set of all bounded distibutions with a common mean).</p>

<p>The moral of the story is: If we can find an e-process for \(\cP\), then we have a sequential test for \(H_0: P\in \cP\), \(H_1:P\notin \cP\). And finding e-processes is made easier via various tools from sequential analysis: martingales, Ville’s inequality, and game-theoretic probability.</p>

<h1 id="4-resources">4. Resources</h1>
<ul>
  <li><a rel="nofollow noopener noreferrer" href="https://arxiv.org/pdf/2210.01948.pdf">Game-theoretic statistics and safe anytime-valid inference</a></li>
</ul>


  <small>
    <a link="back", href="/research_notes/">Back to all notes</a>
  </small>
</article>
 <!-- "> -->
      </main>

      <!-- Footer  -->
      <div class="container" id="footer">
        <hr>
        <div class='container links'>
          <a href="https://github.com/bchugg" rel='nofollow'><img src="/assets/images/github.png"></a>
          <a href="https://www.goodreads.com/user/show/90945992-ben-chugg" rel='nofollow'><img src="/assets/images/goodreads.png"></a>
          <a href="https://twitter.com/BennyChugg" rel='nofollow'><img src="/assets/images/twitter.png"></a>
        </div>
      
        <div class='copyright'>
          <small>&#169; 2023 Ben Chugg</small>
        </div>
      
      </div>
    </div>

  </body>
</html> 
